<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上海电信桥接拨号与ASUS AiMesh支持IPTV机顶盒  @ 王延炯 · 观世界 | World Insight
</title>
    <meta name="description" content="">
    <meta name="author" content="Wang YanJiong">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">


    <link href="/theme/css/sinestudio.css" rel="stylesheet">
    <link href="/theme/css/timeline.css" rel="stylesheet">

        <link href="feeds/all.atom.xml" rel="alternate" title="王延炯 · 观世界 | World Insight" type="application/atom+xml">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141804672-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-141804672-1');
    </script>
    <script src="//code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>

</head>

<body>

<nav class="navbar navbar-expand-sm navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">王延炯 · 观世界 | World Insight</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="/categories/ideas">观点</a></li>
                <li class="nav-item"><a class="nav-link" href="/categories/experiences">经验</a></li>
                <li class="nav-item"><a class="nav-link" href="/categories/violincello">大提琴</a></li>
                <li class="nav-item"><a class="nav-link" href="/categories/bicycles">自行车</a></li>
                <li class="nav-item"><a class="nav-link" href="/categories/book-digests">精文萃义</a></li>
                <li class="nav-item"><a class="nav-link" href="/the-opinion-museum">观点博物馆</a></li>
                <li class="nav-item"><a class="nav-link" href="/three">三</a></li>
                <li class="nav-item"><a class="nav-link" href="/mindset">~Mindset</a></li>
            </ul>
            <span class="navbar-text">start with why, less is more.</span>
        </div>
    </div>
</nav>
<div class="container">

    <div class="row">
        <div class="col-md-3">
<div class="sidebar">
    <h2>目录</h2>
    <div class="toc" id="">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#section-1" id="toc-entry-1">1. 前置条件与运行环境</a><ul>
<li><a class="reference internal" href="#section-2" id="toc-entry-2">1.1 术语</a></li>
<li><a class="reference internal" href="#section-3" id="toc-entry-3">1.1 前置条件</a></li>
<li><a class="reference internal" href="#section-4" id="toc-entry-4">1.2 运行环境</a></li>
<li><a class="reference internal" href="#rt-ac68urt-ac86u" id="toc-entry-5">1.3 RT-AC68U与RT-AC86U的固件差异</a></li>
</ul>
</li>
<li><a class="reference internal" href="#section-5" id="toc-entry-6">2. 核心目标与关键步骤</a></li>
<li><a class="reference internal" href="#section-6" id="toc-entry-7">3. 工具与基本命令</a><ul>
<li><a class="reference internal" href="#vlan" id="toc-entry-8">3.1 VLAN的添加与删除</a></li>
<li><a class="reference internal" href="#vlan-1" id="toc-entry-9">3.2 网桥的添加、删除与关联VLAN</a></li>
<li><a class="reference internal" href="#igmp-snooping" id="toc-entry-10">3.3 IGMP snooping 控制</a></li>
<li><a class="reference internal" href="#robocfg-vlan" id="toc-entry-11">3.4 robocfg 配置物理端口与VLAN的映射</a></li>
</ul>
</li>
<li><a class="reference internal" href="#section-7" id="toc-entry-12">4. 实现方法</a><ul>
<li><a class="reference internal" href="#vlan-2" id="toc-entry-13">4.1 主路由的VLAN与网桥</a></li>
<li><a class="reference internal" href="#igmp-snooping-1" id="toc-entry-14">4.2 主路由的IGMP Snooping配置</a></li>
<li><a class="reference internal" href="#dhcp-option" id="toc-entry-15">4.3 DHCP Option的添加</a></li>
<li><a class="reference internal" href="#aimesh-1vlan" id="toc-entry-16">4.4 「AiMesh节点-1」的VLAN配置</a></li>
<li><a class="reference internal" href="#section-8" id="toc-entry-17">4.5 主路由配置持久化</a></li>
<li><a class="reference internal" href="#aimesh-robocfg" id="toc-entry-18">4.6 AiMesh节点 <cite>robocfg</cite> 配置持久化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#section-9" id="toc-entry-19">5. 实现结果</a></li>
</ul>
</div>
</div>

        </div>
        <div class="col-md-9">
    <div class='article'>
        <div class="article-title">
            <h1>上海电信桥接拨号与ASUS AiMesh支持IPTV机顶盒</h1>
        </div>
        <div class="article-metadata">
<div class="text-center">
  <p>
    <span class="glyphicon">2022-04-02</span>


  </p>
</div>
<div class="text-center">
  <ul class="list-of-tags tags-in-article">
      <li><a href="/tags/asus-aimesh">ASUS AiMesh
            <sup>1</sup></a>
      </li>
      <li><a href="/tags/iptv">IPTV
            <sup>1</sup></a>
      </li>
      <li><a href="/tags/shang-hai-dian-xin">上海电信
            <sup>1</sup></a>
      </li>
      <li><a href="/tags/vlan">VLAN
            <sup>1</sup></a>
      </li>
  </ul>
</div>
<div class="article-summary">
  <p><p class="first">实现效果：<span class="hlr">E-140W-P</span>  --&gt; <span class="hlr">AiMesh</span>  --&gt; <span class="hlr">IPTV机顶盒</span></p>
<p>光猫（上海电信 E-140W-P）</p>
<p>IPTV机顶盒（华为悦盒 EC6108V9C）</p>
<p>ASUS AiMesh 主节点：ASUS RT-AC86U / RT-AC86U_386.5_0_cferom_ubi_0fd614b_koolcenter.w</p>
<p>ASUS AiMesh 节点[1]: ASUS RT-AC68U / RT-AC68U_386.5_0_0fd614b_koolcenter.trx</p>
<p>ASUS AiMesh 节点[2,3,4]：Linksys EA6700 / RT-AC68U_386.5_0_0fd614b_koolcenter.trx</p>
<p class="last">相关概念：dhcp-option, dnsmasq, ifconfig, [linux-kernel/4.1, vconfig, brctl, bcmmcastctl] , [BCM4708, robocfg]</p>
</p>
</div>
        </div>
        <div class="article-content beapow-article">
<div class="section" id="section-1">
<h2><a class="toc-backref" href="#toc-entry-1">1. 前置条件与运行环境</a></h2>
<div class="section" id="section-2">
<h3><a class="toc-backref" href="#toc-entry-2">1.1 术语</a></h3>
<ol class="arabic simple">
<li>光猫：是指由电信运营商安装在用户侧的网络设备。(在本文中，是E-140W-P)</li>
<li>主路由器：是指用户自行购买的，具有PPPoE拨号功能，以及VLAN设置功能的网络设备。(在本文中，是以ASUS RT-AC86U为主节点)</li>
<li><a class="reference external" href="https://www.asus.com/microsite/AiMesh/en/index.html">ASUS AiMesh</a> ：是指ASUS公司的专有AiMesh技术，以实现主节点与AiMesh节点之间的统一管理。</li>
<li>AiMesh 节点：是指由ASUS AiMesh主节点统一管理的接入点。（本文中，可以理解为具有有线与无线接入能力的AP）。</li>
</ol>
</div>
<div class="section" id="section-3">
<h3><a class="toc-backref" href="#toc-entry-3">1.1 前置条件</a></h3>
<ol class="arabic simple">
<li>光猫已经改成桥接，交由路由器拨号接入Internet。</li>
<li>光猫的LAN3或LAN4 口上绑定了传输IPTV的 VLAN 51和VLAN 85</li>
<li>主路由器的WAN口与光猫的LAN3或LAN4通过网线直连。</li>
</ol>
</div>
<div class="section" id="section-4">
<h3><a class="toc-backref" href="#toc-entry-4">1.2 运行环境</a></h3>
<ol class="arabic simple">
<li>网络设备</li>
</ol>
<ul class="simple">
<li><span class="hlr">光猫</span>  [E-140W-P]</li>
<li><span class="hlr">主路由器</span> （Ai Mesh主节点） [ASUS RT-AC86U / RT-AC86U_386.5_0_cferom_ubi_0fd614b_koolcenter.w]</li>
<li><span class="hlr">AiMesh节点-1</span>  [ASUS RT-AC68U / RT-AC68U_386.5_0_0fd614b_koolcenter.trx]</li>
<li><span class="hlb">AiMesh节点-2,3,4</span>  [Linksys EA6700 / RT-AC68U_386.5_0_0fd614b_koolcenter.trx]</li>
<li><span class="hlr">IPTV机顶盒</span>  [华为悦盒 EC6108V9C]</li>
</ul>
<p>注1：<span class="hlr">红色标记的设备</span> 是本文所涉及的硬件设备。</p>
<p>注2：<span class="hlb">AiMesh节点-2,3,4</span> 与本文目标无关。（需要注意的是，在Linksys EA6700上运行的 386.5_0 固件，其外壳上标记的LAN1口是运行时固件中被认定的WAN口。所以，当在AiMesh有线组网时，必须将网线插在外壳标记的LAN1口上，会导致组网失败。救活"没有开放WIFI接入"的AiMesh节点路由器，则需要用网线连接LAN口与电脑，并在电脑上设置为192.168.50.0/24网段中的地址，例如192.168.50.11访问IP地址为192.168.50.1"失联"AiMesh节点路由器。）</p>
<p>注3：下图中显示为RT-AC66U B1的AiMesh节点，实际为「AiMesh节点-2,3,4」中的一个。（没错，Linksys EA6700刷的RT-AC68U固件，显示为RT-AC66U B1）</p>
<img alt="" class="align-center" src="../images/2022/04-02/shanghai-telecom-and-asuswrt-merlin-support-iptv-1.jpg" style="width: 350px;"/>
<ol class="arabic simple" start="2">
<li>光猫到IPTV机顶盒的网络连接</li>
</ol>
<ul class="simple">
<li>物理链路</li>
</ul>
<p><span class="hlr">光猫[LAN4]</span>  --网线-- <span class="hlr">[WAN]主路由器[LAN]</span>  --网线-- <span class="hlr">[WAN]AiMesh节点-1[LAN1]</span>  --网线-- <span class="hlr">[LAN]IPTV机顶盒</span></p>
<p>注1：这里 <span class="hlr">[WAN]主路由器[LAN]</span> 内的[LAN]是指任意一个LAN端口。</p>
<p>注2：这里 <span class="hlr">[WAN]AiMesh节点-1[LAN1]</span> 内的[LAN1]是指「AiMesh节点-1」上的LAN1口，和下面提到的 <cite>robocfg</cite> 配置的 <cite>1t</cite> 直接相关。</p>
<ul class="simple">
<li>光猫A面IP地址分配</li>
</ul>
<p>由于光猫A面接入的是本地AiMesh网络，与Internet无关，所以A面的IP地址分配由主路由器（AiMesh主节点）完成，而AiMesh节点侧不分配IP地址，只透传DHCP数据包。</p>
</div>
<div class="section" id="rt-ac68urt-ac86u">
<h3><a class="toc-backref" href="#toc-entry-5">1.3 RT-AC68U与RT-AC86U的固件差异</a></h3>
<p>虽然AC68U与AC86U都是用了Koolcenter的386.5_0的固件，但是</p>
<ul class="simple">
<li>AC68U是基于Linux 2.6，支持 <cite>robocfg</cite> 配置VLAN且不需要额外配置IGMP Snooping</li>
<li>AC86U是基于Linux 4.1，需要通过 <cite>vconfig</cite> 和 <cite>brctl</cite> 配置VLAN与网桥，以及通过 <cite>bcmmcastctl</cite> 配置组播IGMP Snooping</li>
</ul>
</div>
</div>
<div class="section" id="section-5">
<h2><a class="toc-backref" href="#toc-entry-6">2. 核心目标与关键步骤</a></h2>
<p><span class="center-strong">核心目标</span></p>
<ol class="arabic simple">
<li>保持AiMesh 网络的「一主四从」网络拓扑不变，Internet网络接入功能不变。</li>
<li>实现IPTV机顶盒，通过有线网络连接至AiMesh节点时，可以播放IPTV直播。</li>
</ol>
<p><span class="center-strong">关键步骤</span></p>
<ol class="arabic simple">
<li>主路由器的DHCP Option添加。</li>
<li>主路由器的上的VLAN51,85建立在WAN以及LAN之间。</li>
<li>主路由器的上IGMP snooping开启。</li>
<li>主路由器的DHCP Option配置、VLAN配置与IGMP snooping开启脚本持久化，可以任意断电重启。</li>
<li>在AiMesh节点上，实现节点本地的"上行WAN"与接到IPTV机顶盒的LAN的链路中，支持VLAN51,85，并将配置脚本持久化。</li>
</ol>
</div>
<div class="section" id="section-6">
<h2><a class="toc-backref" href="#toc-entry-7">3. 工具与基本命令</a></h2>
<div class="section" id="vlan">
<h3><a class="toc-backref" href="#toc-entry-8">3.1 VLAN的添加与删除</a></h3>
<ul class="simple">
<li>设置VLAN名称与类型</li>
</ul>
<p><cite>vconfig set_name_type DEV_PLUS_VID_NO_PAD</cite></p>
<p>使得 <cite>vlan_name = interface.vlan_id</cite></p>
<ul class="simple">
<li>添加VLAN</li>
</ul>
<p><cite>vconfig add &lt;interface&gt; &lt;vlan_id&gt;</cite></p>
<ul class="simple">
<li>删除VLAN</li>
</ul>
<p><cite>vconfig rem &lt;vlan_name&gt;</cite></p>
</div>
<div class="section" id="vlan-1">
<h3><a class="toc-backref" href="#toc-entry-9">3.2 网桥的添加、删除与关联VLAN</a></h3>
<ul class="simple">
<li>添加网桥</li>
</ul>
<p><cite>brctl addbr &lt;bridge_name&gt;</cite></p>
<ul class="simple">
<li>删除网桥</li>
</ul>
<p><cite>brctl delbr &lt;bridge_name&gt;</cite></p>
<ul class="simple">
<li>关联VLAN</li>
</ul>
<p><cite>brctl addif &lt;bridge_name&gt; &lt;vlan_name&gt;</cite></p>
<ul class="simple">
<li>查看网桥</li>
</ul>
<p><cite>brctl show [bridge_name]</cite></p>
</div>
<div class="section" id="igmp-snooping">
<h3><a class="toc-backref" href="#toc-entry-10">3.3 IGMP snooping 控制</a></h3>
<ul class="simple">
<li>配置IGMP snooping</li>
</ul>
<p><cite>bcmmcastctl mode -i &lt;vlan_name&gt; -p 1 -m &lt;0,1,2&gt;</cite> 其中&lt;disabled(0), standard(1), blocking(2)&gt;，而 <cite>-p 1</cite> 是特指igmp。</p>
<ul class="simple">
<li>查看IGMP snooping</li>
</ul>
<p>用 <cite>bcmmcastctl show</cite> 查看全部interface 或者使用 <cite>bcmmcastctl show -p -1</cite> 仅查看IGMP相关的interface。</p>
</div>
<div class="section" id="robocfg-vlan">
<h3><a class="toc-backref" href="#toc-entry-11">3.4 robocfg 配置物理端口与VLAN的映射</a></h3>
<p>(注意， <cite>robocfg</cite> 适用于AC68U等基于BCM4708芯片、Linux内核2.6的固件，不适用于AC86U这样基于BCM4906芯片、Linux 4.1内核的固件)</p>
<ul class="simple">
<li>VLAN标签的端口绑定</li>
</ul>
<p><cite>robocfg vlan &lt;vlan_id&gt; ports "&lt;port&gt;t &lt;port&gt;t"</cite></p>
<ul class="simple">
<li>查看VLAN标签与绑定的端口</li>
</ul>
<p><cite>robocfg show</cite></p>
</div>
</div>
<div class="section" id="section-7">
<h2><a class="toc-backref" href="#toc-entry-12">4. 实现方法</a></h2>
<div class="section" id="vlan-2">
<h3><a class="toc-backref" href="#toc-entry-13">4.1 主路由的VLAN与网桥</a></h3>
<p>主路由的WAN为 <cite>eth0</cite> ，LAN为 <cite>br0</cite> 。</p>
<div class="highlight"><pre><span></span>vconfig<span class="w"> </span>set_name_type<span class="w"> </span>DEV_PLUS_VID_NO_PAD
vconfig<span class="w"> </span>add<span class="w"> </span>eth0<span class="w"> </span><span class="m">85</span>
vconfig<span class="w"> </span>add<span class="w"> </span>eth0<span class="w"> </span><span class="m">51</span>
vconfig<span class="w"> </span>add<span class="w"> </span>br0<span class="w"> </span><span class="m">85</span>
vconfig<span class="w"> </span>add<span class="w"> </span>br0<span class="w"> </span><span class="m">51</span>

brctl<span class="w"> </span>addbr<span class="w"> </span>iptv
brctl<span class="w"> </span>addif<span class="w"> </span>iptv<span class="w"> </span>eth0.85
brctl<span class="w"> </span>addif<span class="w"> </span>iptv<span class="w"> </span>eth0.51
brctl<span class="w"> </span>addif<span class="w"> </span>iptv<span class="w"> </span>br0.85
brctl<span class="w"> </span>addif<span class="w"> </span>iptv<span class="w"> </span>br0.51

ifconfig<span class="w"> </span>eth0.85<span class="w"> </span>up
ifconfig<span class="w"> </span>eth0.51<span class="w"> </span>up
ifconfig<span class="w"> </span>br0.85<span class="w"> </span>up
ifconfig<span class="w"> </span>br0.51<span class="w"> </span>up
ifconfig<span class="w"> </span>iptv<span class="w"> </span>up
</pre></div>
</div>
<div class="section" id="igmp-snooping-1">
<h3><a class="toc-backref" href="#toc-entry-14">4.2 主路由的IGMP Snooping配置</a></h3>
<p>在当没有在主路由上配置IGMP snooping为standard(1)的结果，会导致IPTV的直播频道只能播放1分钟或2分钟，之后就会画面静止。</p>
<div class="highlight"><pre><span></span>bcmmcastctl<span class="w"> </span>mode<span class="w"> </span>-i<span class="w"> </span>iptv<span class="w"> </span>-p<span class="w"> </span><span class="m">1</span><span class="w"> </span>-m<span class="w"> </span><span class="m">1</span>
bcmmcastctl<span class="w"> </span>mode<span class="w"> </span>-i<span class="w"> </span>br0<span class="w"> </span>-p<span class="w"> </span><span class="m">1</span><span class="w"> </span>-m<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<div class="section" id="dhcp-option">
<h3><a class="toc-backref" href="#toc-entry-15">4.3 DHCP Option的添加</a></h3>
<p>注意，如果不添加 <cite>=</cite> 号后面的 <cite>lan</cite>，则有可能导致dnsmasq发出的DHCP数据包，在Wireshark解析下出现 <cite>Malformed Packet: DHCP/BOOTP</cite> 的情况。</p>
<div class="highlight"><pre><span></span>dhcp-option-force<span class="o">=</span><span class="m">125</span>,00:00:00:00:1a:02:06:48:47:57:2d:43:54:03:08:45:2d:31:34:30:57:2d:50:0b:02:00:55:0a:02:20:00
dhcp-option-force<span class="o">=</span><span class="m">60</span>,00:00:01:00:02:03:43:50:45:03:0e:45:38:20:47:50:4f:4e:20:52:4f:55:54:45:42:04:03:31:2e:30
dhcp-option<span class="o">=</span><span class="m">15</span>
dhcp-option<span class="o">=</span><span class="m">28</span>
</pre></div>
<p><span class="hlr">注意：由于dhcp-option 15对应的是 Domain Name，所以在AC86U的主路由上，需要配置 RT-AC86U's Domain Name (RT-AC86U 的网域名称)。名称任意，但是不能为空，否则会导致B面地址无法获取的情况。</span></p>
</div>
<div class="section" id="aimesh-1vlan">
<h3><a class="toc-backref" href="#toc-entry-16">4.4 「AiMesh节点-1」的VLAN配置</a></h3>
<p>「AiMesh节点-1」不同于AC86U的主节点，是AC68U，所以可以使用 <cite>robocfg</cite>。另外，IPTV机顶盒通过网线插入在了LAN1口。</p>
<div class="highlight"><pre><span></span>robocfg<span class="w"> </span>vlan<span class="w"> </span><span class="m">85</span><span class="w"> </span>ports<span class="w"> </span><span class="s2">"0t 1t"</span><span class="w"> </span>vlan<span class="w"> </span><span class="m">51</span><span class="w"> </span>ports<span class="w"> </span><span class="s2">"0t 1t"</span>
</pre></div>
<p>其中， <cite>0t</cite> 指的是WAN口要带上VLAN对于的标签， <cite>1t</cite> 指的是LAN1口要带上VLAN对应的标签，总共配置85和51两个端口。</p>
<p>当然，也可以配置成：</p>
<div class="highlight"><pre><span></span>robocfg<span class="w"> </span>vlan<span class="w"> </span><span class="m">85</span><span class="w"> </span>ports<span class="w"> </span><span class="s2">"0t 1t 2t 3t 4t"</span><span class="w"> </span>vlan<span class="w"> </span><span class="m">51</span><span class="w"> </span>ports<span class="w"> </span><span class="s2">"0t 1t 2t 3t 4t"</span>
</pre></div>
<p>在这种情况下，IPTV机顶盒可以插在任意的LAN口上了。</p>
</div>
<div class="section" id="section-8">
<h3><a class="toc-backref" href="#toc-entry-17">4.5 主路由配置持久化</a></h3>
<ol class="arabic simple">
<li>在koolshare软件中心里，安装 「上海电信IPTV v1.2」插件。</li>
<li>根据 4.1-4.3 的配置，修改和替换 <cite>/jffs/.koolshare/scripts/</cite>  目录下的 <cite>shiptv_config.sh</cite> 和 <cite>shiptv_status.sh</cite> 两个脚本，并将 <cite>/jffs/.koolshare/init.d/</cite> 目录下的 <cite>S95Shiptv.sh</cite> 内容，更新到与 <cite>shiptv_config.sh</cite> 一致。（ <cite>S95shiptv.sh</cite> 脚本如果存在，可以删除。）</li>
</ol>
</div>
<div class="section" id="aimesh-robocfg">
<h3><a class="toc-backref" href="#toc-entry-18">4.6 AiMesh节点 <cite>robocfg</cite> 配置持久化</a></h3>
<p>由于在实例中，AiMesh节点所使用的是AC68U的固件，所以有 <cite>robocfg</cite> 的工具支持。另一方面，但由于其不是主路由。所以需要将 4.4 中的配置命令，追加到在 <cite>/jffs/scripts/services-start</cite> 的最后，而同一目录下的 <cite>wan-start</cite> 工作在AiMesh节点时，不会生效。</p>
</div>
</div>
<div class="section" id="section-9">
<h2><a class="toc-backref" href="#toc-entry-19">5. 实现结果</a></h2>
<ol class="arabic simple">
<li>光猫到IPTV机顶盒的逻辑链路</li>
</ol>
<p><span class="hlr">光猫</span>  --[VLAN 51,85]-- <span class="hlr">主路由器</span>  --[VLAN 51,85]-- <span class="hlr">AiMesh节点-1</span>  --[VLAN 51,85]-- <span class="hlr">IPTV机顶盒</span></p>
<ol class="arabic simple" start="2">
<li>「AiMesh节点-1」上支持IPTV机顶盒的VLAN</li>
</ol>
<ul class="simple">
<li>使用 <cite>robocfg show</cite> 查看</li>
</ul>
<img alt="" class="align-center" src="../images/2022/04-02/shanghai-telecom-and-asuswrt-merlin-support-iptv-2.jpg"/>
<ol class="arabic simple" start="3">
<li>主路由的VLAN 51,85配置</li>
</ol>
<ul class="simple">
<li>使用 <cite>cat /proc/net/vlan/config</cite> 查看</li>
</ul>
<img alt="" class="align-center" src="../images/2022/04-02/shanghai-telecom-and-asuswrt-merlin-support-iptv-3.jpg"/>
<ul class="simple">
<li>使用 <cite>ip addr</cite> 查看</li>
</ul>
<img alt="" class="align-center" src="../images/2022/04-02/shanghai-telecom-and-asuswrt-merlin-support-iptv-4.jpg"/>
<ol class="arabic simple" start="4">
<li>主路由服务于VLAN 51,85的网桥</li>
</ol>
<p>名为 <cite>iptv</cite> 的网桥，负责了51,85两个VLAN的桥接。</p>
<img alt="" class="align-center" src="../images/2022/04-02/shanghai-telecom-and-asuswrt-merlin-support-iptv-5.jpg"/>
<ol class="arabic simple" start="5">
<li>主路由IGMP snooping</li>
</ol>
<p>在网桥 <cite>iptv</cite> 以及 主路由器的 LAN (br0) 上，都启用了IGMP snooping( <cite>snooping mode 1</cite> ) ，但在 <cite>br0.85</cite> 以及  <cite>br0.51</cite> 上，都blocking了IGMP snooping ( <cite>snooping mode 2</cite> )</p>
<img alt="" class="align-center" src="../images/2022/04-02/shanghai-telecom-and-asuswrt-merlin-support-iptv-6.jpg"/>
<ol class="arabic simple" start="6">
<li>主路由网络吞吐</li>
</ol>
<ul class="simple">
<li><cite>eth0</cite> 主路由WAN口，被光猫分配到的是 192.168.1.0/24的地址，即192.168.1.3</li>
<li><cite>br0</cite> 主路由内部的LAN，自主DHCP的网段是 10.0.0.0/24的地址，即主路由IP地址为10.0.0.1</li>
</ul>
<img alt="" class="align-center" src="../images/2022/04-02/shanghai-telecom-and-asuswrt-merlin-support-iptv-7.jpg"/>
</div>
</div>
    </div>
        <hr>
        </div>
    </div> </div>

<div class="footer">
  <p><a rel="license" href="//creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/theme/images/icons/cc-by-nc-nd-40-80x15.png" /></a>
    <a href="/feeds/all.atom.xml"><img src="/theme/images/icons/rss.png"/></a>
  </p>
  <p>&copy; 2011-2023 <a href="//yanjiong.wang">王延炯博士</a>
      <a href="//cn.linkedin.com/in/wangyanjiong"><img src="/theme/images/icons/linkedin.png"/></a>
      <a href="//github.com/sinewang"><img src="/theme/images/icons/github.png"/></a>
      <a href="/images/qrcode/qrcode_for_drwangyanjiong.jpg"><img src="/theme/images/icons/wechat.png"/></a>
      <a href="//weibo.com/sinewang"><img src="/theme/images/icons/weibo.png"/></a>
      <a href="//www.douban.com/people/sinewang"><img src="/theme/images/icons/douban.png"/></a>
  </p>
  <p>
  </p>
  <p class="powered-by">POWERED BY <a href="//getpelican.com">Pelican</a> & <a href="//github.com/sinewang/pelican-beapow">beapow</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>